# FlowerKnightGirlPlayer

某寢室再生機。

## 動作要件

- Windows 10 以降のWindows OS
- MSVC 2015-2022 (x64)

## 再生方法

メニュー欄`File -> Open` から台本ファイル(`*.txt`)を選んで下さい。  
台本ファイル読み取り後、次の相対位置に関連ファイルがあると想定して場面の再生を開始します。
<pre>
...
├ Episode
│  ├ 100001.txt // 台本ファイル
│  ├ 100001_2.txt
│  └ ...
└ Resource
    ├ 100001 // 音声フォルダ
    │  ├ fkg_100001_hscene001.mp3
    │  ├ ...
    │  ├ fkg_100001_hscene201.mp3
    │  └ ...
    ├ ...
    ├ hscene_r18 // 静画フォルダ
    │  ├ r18_100001_000.png
    │  ├ r18_100001_001.png
    │  ├ r18_100001_100.png
    │  └ ...
    └ hscene_r18_spine // Spine素材フォルダ
       ├ r18_spine_100011_000.atlas
       ├ r18_spine_100011_000.json
       ├ r18_spine_100011_000.png // 中身はwebp形式
       ├ r18_spine_100011_000_2.png
       └ ...
</pre>

## メニュー機能

| 分類 | 項目 | 機能 |
| --- | --- | --- |
| File | Open | 台本ファイル選択ダイアログ表示。 |
| Setting | Audio | 音声設定ダイアログ表示。 |
| - | Filter | 静止画読み込み時の補間法指定。 |
| Image | Sync | 画像と文章を同期 / 独立して制御。 |

- 静止画に関しては元の解像度の関係上、読み込み時に補間を掛けて拡大しています。
  - メニュー欄`Setting->Filter`から補間法を選択できます。
    - 既定では双三次補間を適用します。読み込み速度は`None`(補間無し) > `Cubic` > `Lanczos` > `Avir`の順になるかと思います。
  - あくまで読み込み時の補間です。再生開始後の拡縮の際は双線形補間が適用されます。

## マウス機能

| 入力 | 機能 |
| ---- | ---- | 
| ホイール回転 | 窓の拡大・縮小。`Ctrl`を押しながらで寄り・引き。 |
| 左押し + ホイール回転 | (静画) 機能なし。 <br> (動画) 加速・減速。 |
| 左クリック | 画像・動作切り替え。同期を切った場合のみ動作。 |
| 左ドラッグ | (静画) 表示範囲移動。ディスプレイ解像度以上に拡大した場合のみ動作。<br>(動画) 視点移動。 |
| 中クリック | (静画) 原寸大表示。<br> (動画) 尺度・視点・速度初期化。 |
| 右クリック | 場面遷移メニュー表示。 |
| 右押し + ホイール回転 | 文章送り・戻し。 |
| 右押し + 中クリック| 窓枠消去・表示。消去時にはディスプレイ原点位置に移動。 |
| 右押し + 左クリック| 窓移動。窓枠消去時のみ動作。 |

## キーボード機能

| 入力 | 機能 |
| ---- | ---- |
| <kbd>Esc</kbd> | 終了。 |
| <kbd>↑</kbd> | 前の台本ファイルを開く。 |
| <kbd>↓</kbd> | 次の台本ファイルを開く。 |
| <kbd>→</kbd> | 文章送り。 |
| <kbd>←</kbd> | 文章戻し。 |
| <kbd>C</kbd> | 文字色黒・白切り替え。 |
| <kbd>T</kbd> | 文章表示・非表示切り替え。 |

例えば`100011.txt`を再生していた場合、キー操作で`100001_2.txt`や`100011_2.txt`の再生に移ることができます。
<pre>
Episode
├ 100001_2.txt
├ 100011.txt
├ 100011_2.txt
└ ...
</pre>

## 外部ライブラリ

- [DXライブラリ](https://dxlib.xsrv.jp/dxdload.html)
- [spine-cpp 3.8](https://github.com/EsotericSoftware/spine-runtimes/tree/3.8)
- [AVIR](https://github.com/avaneev/avir)

## 構築方法

`Visual Studio`が必要になります。

1. `src/deps`階層をVisual Studioから開く。
   - 一例として、次のような方法で開くことができます。
     - 同階層をファイルエクスプローラから開いた状態で、階層表示欄に`cmd`と入力し、コマンドプロンプトを起動。
     - 次に、コマンドプロンプト上で`start devenv .`と入力するとVisual Studioが起動します。
2. CMakeによる外部ライブラリの取得・配置完了を待つ。
3. Spine汎用ランタイムを`x64-Debug`向け並び`x64-Release`向けにインストール。
   - メニュー欄`ビルド->...のインストール`から行えます。
4. `FlowerKnightGirlPlayer.sln`を開き、メニュー欄`ビルド->ソリューションのビルド`を実行。

## 補足説明

- 紋理 (Texture)
  -  Spine側によるファイル検索の都合上、拡張子は`.png`としていますが中身は`webp`形式です。
- 文章表示
  - `游明朝`が搭載されている必要があります。 
